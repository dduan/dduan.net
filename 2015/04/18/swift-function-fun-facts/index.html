<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Daniel Duan">
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://duan.ca/2015/04/18/swift-function-fun-facts/">
    <meta property="og:site_name" content="Daniel Duan's Website">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Swift Function Fun Facts">
    <meta property="article:published_time" content="2015-04-18"><meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@daniel_duan">
    <meta name="twitter:creator" content="@Daniel Duan">
    <meta name="apple-mobile-web-app-title" content="Daniel Duan">
    <title>Swift Function Fun Facts</title>
    <link rel="alternate" type="application/rss+xml" title="Daniel Duan's Website" href="/feed.xml">
    <link rel="canonical" href="https://duan.ca/2015/04/18/swift-function-fun-facts/">
    <link rel="stylesheet" href="/styles.css"></link>
    <link rel="shortcut icon" href="/favicon.ico">
</head>
<body><article>
    <h1>Swift Function Fun Facts</h1>
    <nav>
        <p class="metainfo article-meta">
            <a href="/">Daniel Duan</a>
            ·
            <time datetime="2015-04-18" itemProp="datePublished">2015-04-18</time>
        </p>
    </nav><p>You love Swift. You want to write a class that does HTTP, it might have
methods like the following:</p>
<pre><span class="source swift"><span class="meta function"><span class="meta toc-list"><span class="storage type function">func</span> <span class="entity name function"><span class="variable function">get</span></span>(<span class="support class">URLString</span>:<span class="support class">String</span>, <span class="variable parameter">params</span>:[<span class="support class">String</span>:<span class="support class">AnyObject</span>],
    <span class="variable parameter">headers</span>:[<span class="support class">String</span>:<span class="support class">String</span>])</span></span>
<span class="meta function"><span class="meta toc-list"><span class="storage type function">func</span> <span class="entity name function"><span class="variable function">post</span></span>(<span class="support class">URLString</span>:<span class="support class">String</span>, <span class="variable parameter">params</span>:[<span class="support class">String</span>:<span class="support class">AnyObject</span>],
    <span class="variable parameter">headers</span>:[<span class="support class">String</span>:<span class="support class">String</span>])</span></span>
<span class="meta function"><span class="meta toc-list"><span class="storage type function">func</span> <span class="entity name function"><span class="variable function">put</span></span>(<span class="support class">URLString</span>:<span class="support class">String</span>, <span class="variable parameter">params</span>:[<span class="support class">String</span>:<span class="support class">AnyObject</span>],
    <span class="variable parameter">headers</span>:[<span class="support class">String</span>:<span class="support class">String</span>])</span></span>
<span class="comment line"><span class="punctuation definition comment">//</span> and more for HEAD, OPTIONS …</span>

</span></pre>
<p>But you don't want to force your user to supply all arguments each time. You
know that Swift supports default arguments, so you added some. Take GET as an
example:</p>
<pre><span class="source swift"><span class="meta function"><span class="meta toc-list"><span class="storage type function">func</span> <span class="entity name function"><span class="variable function">get</span></span>(<span class="support class">URLString</span>:<span class="support class">String</span>, <span class="variable parameter">params</span>:[<span class="support class">String</span>:<span class="support class">AnyObject</span>]=[:],
    <span class="variable parameter">headers</span>:[<span class="support class">String</span>:<span class="support class">String</span>]=[:])</span></span>

</span></pre>
<p>Now users can do things like</p>
<p>{% highlight swift %}
get(&quot;http://github.com&quot;)
get(&quot;http://httpbin.org/get&quot;, headers:[&quot;Answer&quot;:42])
{% endhighlight %}</p>
<p>That's flexible! Woohoo!</p>
<p>After you thought about implementing these, though, you realize that
<code>HTTPMethod</code> is merely a property on <code>NSURLRequest</code>. In other words, all of
the previous methods can share the same implementation. In honor of the DRY
principle, you write a function that accepts the method as an arguments and
the previous functions each forwards the arguments to this function:</p>
<pre><span class="source swift"><span class="meta function"><span class="meta toc-list"><span class="storage type function">func</span> <span class="entity name function"><span class="variable function">impl</span></span>(<span class="variable parameter">method</span>:<span class="support class">String</span>, <span class="support class">URLString</span>:<span class="support class">String</span>,
    <span class="variable parameter">params</span>:[<span class="support class">String</span>:<span class="support class">AnyObject</span>],
    <span class="variable parameter">headers</span>:[<span class="support class">String</span>:<span class="support class">String</span>])</span></span>
{
    <span class="comment line"><span class="punctuation definition comment">//</span> …</span>
}

<span class="meta function"><span class="meta toc-list"><span class="storage type function">func</span> <span class="entity name function"><span class="variable function">get</span></span>(<span class="support class">URLString</span>:<span class="support class">String</span>, <span class="variable parameter">params</span>:[<span class="support class">String</span>:<span class="support class">AnyObject</span>]=[:],
    <span class="variable parameter">headers</span>:[<span class="support class">String</span>:<span class="support class">String</span>]=[:])</span></span>
{
    impl(<span class="string quoted double">&quot;GET&quot;</span>, <span class="support class">URLString</span>:<span class="support class">URLString</span>, <span class="variable parameter">params</span>:params,
        <span class="variable parameter">headers</span>:headers)
}

<span class="meta function"><span class="meta toc-list"><span class="storage type function">func</span> <span class="entity name function"><span class="variable function">post</span></span>(<span class="support class">URLString</span>:<span class="support class">String</span>, <span class="variable parameter">params</span>:[<span class="support class">String</span>:<span class="support class">AnyObject</span>]=[:],
    <span class="variable parameter">headers</span>:[<span class="support class">String</span>:<span class="support class">String</span>]=[:])</span></span>
{
    impl(<span class="string quoted double">&quot;POST&quot;</span>, <span class="support class">URLString</span>:<span class="support class">URLString</span>, <span class="variable parameter">params</span>:params,
        <span class="variable parameter">headers</span>:headers)
}
</span></pre>
<p>This seems like a sensible solution. Except that later you realize that there
needs to be more parameters for each function, so in the end, each function
looks like this:</p>
<pre><span class="source swift"><span class="meta function"><span class="meta toc-list"><span class="storage type function">func</span> <span class="entity name function"><span class="variable function">post</span></span>(
    <span class="support class">URLString</span>             : <span class="support class">String</span>,
    params                : [<span class="support class">String</span>:<span class="support class">AnyObject</span>]       = [:],
    json                  : [<span class="support class">String</span>:<span class="support class">AnyObject</span>]?      = <span class="constant language nil">nil</span>,
    headers               : [<span class="support class">String</span>:<span class="support class">AnyObject</span>]       = [:],
    auth                  : (<span class="support class">String</span>,<span class="support class">String</span>)<span class="keyword operator">?</span>         = <span class="constant language nil">nil</span>,
    allowRedirects        : <span class="support class">Bool</span>                     = <span class="constant language true">true</span>,
    requestBody           : <span class="support class">NSData</span><span class="keyword operator">?</span>                  = <span class="constant language nil">nil</span>,
    <span class="support class">URLQuery</span>              : <span class="support class">String</span><span class="keyword operator">?</span>                  = <span class="constant language nil">nil</span>,
    <span class="variable parameter">asyncCompletionHandler</span>: ((<span class="support class">HTTPResult</span><span class="keyword operator">!</span>) -&gt; <span class="support class">Void</span>)<span class="keyword operator">?</span> = <span class="constant language nil">nil</span>
    )</span></span> -&gt; <span class="support class">HTTPResult</span> {
    <span class="keyword control">return</span> impl(
        <span class="string quoted double">&quot;POST&quot;</span>,
        <span class="support class">URLString</span>             : <span class="support class">URLString</span>,
        params                : params,
        json                  : json,
        headers               : headers,
        auth                  : auth,
        data                  : requestBody,
        <span class="support class">URLQuery</span>              : <span class="support class">URLQuery</span>,
        redirects             : allowRedirects,
        <span class="variable parameter">asyncCompletionHandler</span>: asyncCompletionHandler
    )
}
</span></pre>
<p>Remembering that your goal is to respect DRY, and there are now giant blocks
of code that all look the same except that first argument to <code>impl()</code>, you
became determined to find a better alternative.</p>
<p>Well, why not give currying a try? This example of currying with Swift comes
to your mind:</p>
<p>{% highlight swift %}
func add(a:Int)(b:Int) -&gt; Int { return a + b }
let add3 = add(3)
add3(b:2) // 5
{% endhighlight %}</p>
<p>If we apply this technique and treat <code>method</code> in <code>impl()</code> as <code>a</code> in the
example, we would get:</p>
<pre><span class="source swift"><span class="meta function"><span class="meta toc-list"><span class="storage type function">func</span> <span class="entity name function"><span class="variable function">impl</span></span>(<span class="variable parameter">method</span>:<span class="support class">String</span>)</span></span>(
    <span class="support class">URLString</span>:<span class="support class">String</span>,
    <span class="variable parameter">params</span>:[<span class="support class">String</span>:<span class="support class">AnyObject</span>],
    <span class="variable parameter">headers</span>:[<span class="support class">String</span>:<span class="support class">String</span>],
    …)
{
    <span class="comment line"><span class="punctuation definition comment">//</span> …</span>
}
<span class="keyword variable">let</span> <span class="keyword control">get</span> = impl(<span class="string quoted double">&quot;GET&quot;</span>)
<span class="keyword variable">let</span> post = impl(<span class="string quoted double">&quot;POST&quot;</span>)
</span></pre>
<p>right?  However, you are forcing users to supply each argument again. To make
things worse, the number of arguments is a lot larger.</p>
<p>Hmm, but that's a solved problem, just add default values to <code>impl()</code>'s
parameters:</p>
<pre><span class="source swift"><span class="meta function"><span class="meta toc-list"><span class="storage type function">func</span> <span class="entity name function"><span class="variable function">impl</span></span>(<span class="variable parameter">method</span>:<span class="support class">String</span>)</span></span>(
    <span class="support class">URLString</span>:<span class="support class">String</span>,
    <span class="variable parameter">params</span>:[<span class="support class">String</span>:<span class="support class">AnyObject</span>] = [:],
    <span class="variable parameter">headers</span>:[<span class="support class">String</span>:<span class="support class">String</span>] = [:],
    …)
{
    <span class="comment line"><span class="punctuation definition comment">//</span> …</span>
}
</span></pre>
<p>Ta-da! Wait a minute, Xcode now refuse to compile you code! <code>Default argument is only permitted for a non-curried function parameter</code>, it saids.</p>
<p>Stubborn as you are, you decide that perhaps the Swift team hasn't got around
to implementing this feature for curry syntax yet. Functions are first-class
citizens! Surely if you return a function with default arguments…?</p>
<pre><span class="source swift"><span class="meta function"><span class="meta toc-list"><span class="storage type function">func</span> <span class="entity name function"><span class="variable function">methodFactory</span></span>(<span class="variable parameter">method</span>:<span class="support class">String</span>)</span></span>
    -&gt; (<span class="variable parameter">params</span>:[<span class="support class">String</span>:<span class="support class">AnyObject</span>] = [:],
        <span class="variable parameter">headers</span>:[<span class="support class">String</span>:<span class="support class">String</span>] = [:], …)
    -&gt; <span class="support class">Void</span>
{
    <span class="keyword control">return</span> {(params, headers, …) <span class="keyword control">in</span>
        impl(method, <span class="variable parameter">params</span>:params, <span class="variable parameter">headers</span>:headers, …)
    }
}

<span class="keyword variable">let</span> <span class="keyword control">get</span> = methodFactory(<span class="string quoted double">&quot;GET&quot;</span>)
<span class="keyword variable">let</span> post = methodFactory(<span class="string quoted double">&quot;POST&quot;</span>)
</span></pre>
<p>Turns out, this manual form of currying only works when default arguments
aren't involved!</p>
<p>Now, you hate Swift.</p>
<p>(Just to be clear, I don't really hate Swift as in, uh, <em>hate</em> Swift. Judgning
from some comments, I might have failed to convey the lightheartedness that
I felt writing this up. It's really like saying to a friend &quot;I hate you&quot; after
he/she pulls a prank on you.)</p>

</article>
<footer>
    <hr />
    <p class="metainfo article-meta">
        <a href="/articles/">More Articles</a>
        ·
        <a href="/tag/swift/">Swift</a>
    </p>
</footer></body>
</html>