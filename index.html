<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Daniel Duan</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,600">
  <link rel="stylesheet" href="/style.css">
  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Daniel Duan" href="/feed.xml" />
  <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Daniel Duan | Daniel Duan’s Thoughts And Works.</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Daniel Duan" />
<meta name="author" content="Daniel Duan" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Daniel Duan’s Thoughts And Works." />
<meta property="og:description" content="Daniel Duan’s Thoughts And Works." />
<link rel="canonical" href="https://duan.ca/" />
<meta property="og:url" content="https://duan.ca/" />
<meta property="og:site_name" content="Daniel Duan" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@daniel_duan" />
<meta name="twitter:creator" content="@Daniel Duan" />
<script type="application/ld+json">
{"name":"Daniel Duan","description":"Daniel Duan’s Thoughts And Works.","author":{"@type":"Person","name":"Daniel Duan"},"@type":"WebSite","url":"https://duan.ca/","headline":"Daniel Duan","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body>
  <div class="container">
    <header class="masthead">
  <h1 class="masthead-title">
    <a href="/">Daniel Duan<span>&#39;s blog</span></a>
  </h1>
  <nav class="masthead-nav">
    
    <a href="/articles">articles</a>
    
    <a href="https://www.youtube.com/channel/UCkBVC0dMgyUnxzettP7qE-A">videos</a>
    
    <a href="/links">Links</a>
    
    <a href="/projects">Projects</a>
    
    <a href="/about">About</a>
    
  </nav>
</header>
<div class="content page">
  <h3 class="page-title"></h3>
  


  
  <div class="content post">
    
    <h1 class="post-title"><a href="/2019/03/10/toml-decoder/">TOML Decoder Playlist</a></h1>
    
    <div class="post-date">
      
      <time>10 Mar 2019</time>
      
       |
      <div class="post-tags">
      
        <a href="/tag/toml">TOML</a>,
      
        <a href="/tag/swift">Swift</a>
      
      </div>
      
    </div>
    <p>I enjoyed making <a href="https://github.com/dduan/TOMLDeserializer">TOMLDeserializer</a> and <a href="https://github.com/dduan/TOMLDecoder">TOMLDecoder</a> recently. Let’s hope
some projects will pick them up and TOML as a configuration format will start to
spead in Swift communities.</p>

<p>What’s outstanding about these projects is that I started working on them while
<a href="https://twitch.tv/daniel_duan">streaming</a>. Personally, I consume a lot of content like this. So now people
can watch me writing Swift, too.</p>

<p>I’ve been archiving recordings of these streams as much as I can. Here are the
links to these videos, each is around 1-1.5 hours long:</p>

<p><a href="https://youtu.be/XLLlCEfuFLw">Turn TOML Test Fixtures Into XCTests With Vim Macros</a>
<a href="https://youtu.be/Ztq3K3cq8f0">Passing TOML Deserialization Tests</a>
<a href="https://youtu.be/GTCYSIc6n3U">Finishing TOML Invalidation Tests</a>
<a href="https://youtu.be/HP2Wzh8MVvg">TOML Decoder: The Beginning</a>
<a href="https://youtu.be/EZ7VpbrLkH0">TOML Decoder: Filling In Missing Implementation Pieces</a>
<a href="https://youtu.be/bISMVVWOHKg">TOML Decoder: Adding The First TOML Decoding Strategy!</a>
<a href="https://youtu.be/oOOS4bnhwx4">TOML Decoder: Project Overview And Data Decoding Support</a>
<a href="https://youtu.be/9yDtXsrMtbU">TOML Decoder: Key Decoding Strategies</a>
<a href="https://youtu.be/g1V872HL4Dk">TOML Decoder: Project Updates</a></p>

<p>The TOMLDecoder projects would’ve been capture on camera entirely if I weren’t
such a streaming n00b and messed up a few streams. Hilarious.</p>


  </div>
  <hr />
  
  <div class="content post">
    
    <h1 class="post-title"><a href="/2019/01/20/kick-ass-cli-tools-in-swift/">Kick-ass CLI Tools In Swift</a></h1>
    
    <div class="post-date">
      
      <time>20 Jan 2019</time>
      
       |
      <div class="post-tags">
      
        <a href="/tag/swift">Swift</a>,
      
        <a href="/tag/cli">CLI</a>,
      
        <a href="/tag/posix">POSIX</a>
      
      </div>
      
    </div>
    <p>As someone who lives in a terminal simulator, I’m pleasantly surprised by the
new toys we get in recent years such as <a href="https://github.com/junegunn/fzf">fzf</a>, <a href="https://github.com/BurntSushi/ripgrep">ripgrep</a>, <a href="https://github.com/sharkdp/fd">fd</a>, etc.
A great number of these are written in relatively young programming languages
such as Go and Rust. But, noticibly, none of them are written in Swift.</p>

<p>In this post, I’ll try to explain why that is.</p>

<h2 id="posix-ergonomics">POSIX Ergonomics</h2>

<p>Unix-like virtual file systems has been around for decades. API that manupulates
such systems has standardized a long time ago and exists in most computers
running Linux/BSD/macOS today (and, to a large extend, smart phones). To Swift
users, Using these APIs is straight-forward (<code class="highlighter-rouge">rmdir("path/to/dir")</code>).</p>

<p>So Swift programmers are all happy campers (re-)inventeing all sorts of file
system utilities, right?</p>

<p>Well, not quite.</p>

<p>Okay, I lied about POSIX APIs being “straight-forward” in Swift. Or rather, this
is very subjective.</p>

<p>Continuing with the <code class="highlighter-rouge">rmdir</code> example, we must first import it from either <code class="highlighter-rouge">Glibc</code>
or <code class="highlighter-rouge">Darwin</code>, depending on your OS. To know whether the operation is successful,
we need to see whether it returned integer 0. To learn <em>why</em> 0 was not returned,
we need to read the “magical” variable <code class="highlighter-rouge">errno</code>. <code class="highlighter-rouge">errno</code> could be written to by
other APIs so we’d better capture it in time…</p>

<p>And that’s one of the simpler APIs in POSIX calls!</p>

<p>Programmers whine about ergonomics partially because we are previlidged and
spoiled. But mostly because our attention is a limited resources. Mixing API
conventions distracts us from solving the problem at hand. Bad ergonomics,
therefore, drives away a good potion of users who cares about quality of their
tools.</p>

<h2 id="culture-and-history">Culture and History</h2>

<p>As of this writing, the release of Swift 5 is imminent. The vast majority of
existing Swift code is written to run on iOS. The concept of a file, or the
traditional virtal file system, is hidden to iOS users, and sandboxed for
developers. I bet most Swift users rarely think about the fact that there’s
a entire set of POSIX API at their disposal.</p>

<p><code class="highlighter-rouge">Foundation</code> alleviates the need to deal with files and directories: <code class="highlighter-rouge">Bundle</code>
locates the files; <code class="highlighter-rouge">CoreData</code>, <code class="highlighter-rouge">UserDefaults</code> or the keychain is your primary
way to persist data; <code class="highlighter-rouge">Data</code>, <code class="highlighter-rouge">String</code> or <code class="highlighter-rouge">NSCoding</code> has methods to read and
write to files.  And finally, if you really need to deal with files,
<code class="highlighter-rouge">NSFileManager</code> has everything you’ll ever need.</p>

<p>Why would a productive Swift programmer think about POSIX in this environment?
Why would a tutor teach POSIX over the useful/practical/”native” alternatives?</p>

<p>We can trace “riding on the Apple platform” mentality back to the pre-iPhone
days, where a very small Mac developer community labors on on a niche platform
(compared to iOS today) and they <em>loved</em> it. However, I’m sure they used more
POSIX stuff back then than the average iOS developers today.</p>

<p>Having a great library such as Foundation on the most popular developer
platform where the language thrives means it’ll take longer for “subcultures”
to emerge, if they do at all.</p>

<h2 id="the-standard-library-and-its-influence-on-new-users">The Standard Library And Its Influence on New Users</h2>

<p>File system APIs being in <code class="highlighter-rouge">Foundation</code> as opposed to the standard library is
probably a temporary condition. Nevertheless, it has at least the following
implications:</p>

<ol>
  <li>
    <p>Its quality of implementation is not held on the same standard that those
APIs in the standard library. This is especially true for the separate,
open-source <code class="highlighter-rouge">Foundation</code> implementation. Getting consistent and correct
behaviors across macOS and Linux is hard.</p>
  </li>
  <li>
    <p>A person learning Swift won’t explore the language with a file system API.
This I suspect, is <strong>the most important reason many of these great CLI
utilites are written in other programming languages</strong>. Programmers seek
instant gratification when they learn. And they usually stay in a limited
domain (like iOS) at first. This is where the built-in library is special: no
matter which domain is chosen, it’s always available. Languages such as Go
and Rust include things like paths and files in their built-in library.
Playing with these APIs while learning the lanugage plants a seed for future,
serious, projects. There are less users of these languages compared to Swift,
but there are more people thinking about projects that involves file systems
in thoes communities. (Note I don’t have statistics here, just a guess.)</p>
  </li>
</ol>

<h2 id="conclusion">Conclusion</h2>

<p>The next killer CLI tool is still more likely to be written in Go or Rust,
than in Swift. Hopefully, somewhere in these speculations is a true cause of
this phenomena. Maybe someone reading this will be inspired to accelerate change
that will eventually revert the condition. (I’m <a href="https://github.com/dduan/Pathos">trying</a>).</p>


  </div>
  <hr />
  
  <div class="content post">
    
    <h1 class="post-title"><a href="/2018/09/01/magical-interaction/">Magical Interactions</a></h1>
    
    <div class="post-date">
      
      <time>01 Sep 2018</time>
      
       |
      <div class="post-tags">
      
        <a href="/tag/swift">Swift</a>,
      
        <a href="/tag/haskell">Haskell</a>
      
      </div>
      
    </div>
    <p>I want to talk about this little function:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">interact</span><span class="p">(</span><span class="n">_</span> <span class="nv">process</span><span class="p">:</span> <span class="p">(</span><span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">input</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">while</span> <span class="k">let</span> <span class="nv">line</span> <span class="o">=</span> <span class="nf">readLine</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">input</span> <span class="o">+=</span> <span class="n">line</span>
    <span class="p">}</span>

    <span class="nf">print</span><span class="p">(</span><span class="nf">process</span><span class="p">(</span><span class="n">input</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Brief explanation: it reads all the input from stdin as a <code class="highlighter-rouge">String</code>, feeds it
into a closure <code class="highlighter-rouge">process</code>, which it takes in as its only argument, and prints
<code class="highlighter-rouge">process</code>’s output.</p>

<p>Here’s how one might use it:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// counts characters from stdin and prints result to stdout</span>
<span class="n">interact</span> <span class="p">{</span> <span class="kt">String</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div></div>

<p>Got that? Well, now I’m going to rewrite it in a slightly less Swift-y way:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">count</span><span class="p">:</span> <span class="p">(</span><span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kt">String</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">interact</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</code></pre></div></div>

<p>The argument for <code class="highlighter-rouge">interact</code> got defined with a name and an explicit type
signature.</p>

<p>So, what’s so special about this <code class="highlighter-rouge">interact</code> function? Two words: <em>side effects</em>.
More precisely, it took away the concern of side-effects from the user. <code class="highlighter-rouge">count</code>
belongs in the realm of <em>pure</em> functions. It has no worries about file handles
or operating systems. It’s <code class="highlighter-rouge">(String) -&gt; String</code>. I wanted to emphasize this with
the rewrite. Look at that empty line. Now you see a boundary between 2 worlds.</p>

<p>This may all seem contrived. But when I learned about <a href="http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:interact">this function in
Haskell</a>, I was blown away.</p>

<p>It’s like a great magic trick: you are presented a scenario, say, writing
a little script. Maybe you need to process some CLI output and print out a CSV
or JSON string (literally 90% of the script I write).  A Haskell programmer
would jump into the bottom level of the problem and start writing these little
pure functions: one to split the string, one to convert some numbers, one to
manipulate a list, one to match some patterns…gradually the broken-down
absractions get built back up via function composition. You can see the light at
the end of the tunnel, yes, yes! If you feed this list into that function that
returns a string you’ll have the right value to print out!  Okay, now the
problem is solved in the pure functional world! The only thing left to do is…</p>

<p>Now, the setup of the magic is complete. Now, you are onboard with the solution,
you thought the problem through with the magician…you are distracted. The
ending came so…quickly, but unexpected. What? You just feed your solution to
this <code class="highlighter-rouge">interact</code> function and…that’s it? I was expecting some <code class="highlighter-rouge">readLine</code>s or
<code class="highlighter-rouge">print</code>s (okay, at least 1 <code class="highlighter-rouge">print</code> statement)!</p>

<p>That’s the thing: <code class="highlighter-rouge">interact</code> deals with <em>two</em> side effects, the input and the
output. But its user deals with <em>zero</em>. It’s as if the two effects “cancel” each
other out! It’s a <em>neat</em> trick, really. Small, low-key, easy to miss. But I’m
glad I noticed it and come to appreciate its power and simplicity.</p>


  </div>
  <hr />
  


<footer class="masthead">
<h4>Read More:</h4>
<nav class="masthead-nav">
  
  <a href="/articles">articles</a>
  
  <a href="https://www.youtube.com/channel/UCkBVC0dMgyUnxzettP7qE-A">videos</a>
  
  <a href="/links">Links</a>
  
  <a href="/projects">Projects</a>
  
  <a href="/about">About</a>
  
</nav>
</footer>

</div>

  </div>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)
    },i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-59501714-1', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
