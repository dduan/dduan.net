<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Daniel Duan</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,600">
  <link rel="stylesheet" href="/style.css">
  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Daniel Duan" href="/feed.xml" />
  <!-- Begin Jekyll SEO tag v1.4.0 -->
<title>Daniel Duan - Daniel Duan thinks.</title>
<meta property="og:title" content="Daniel Duan" />
<meta name="description" content="Daniel Duan thinks." />
<meta property="og:description" content="Daniel Duan thinks." />
<link rel="canonical" href="http://dduan.net/" />
<meta property="og:url" content="http://dduan.net/" />
<meta property="og:site_name" content="Daniel Duan" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@daniel_duan" />
<meta name="twitter:creator" content="@Daniel Duan" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Daniel Duan",
    "headline": "Daniel Duan",
    "description": "Daniel Duan thinks.",
    "url": "http://dduan.net/"
  }
</script>
<!-- End Jekyll SEO tag -->
</head>
<body>
  <div class="container">
    <header class="masthead">
  <h1 class="masthead-title">
    <a href="/">Daniel Duan<span>&#39;s blog</span></a>
  </h1>
  <nav class="masthead-nav">
    
    <a href="/articles">articles</a>
    
    <a href="/links">Links</a>
    
    <a href="/projects">Projects</a>
    
    <a href="/about">About</a>
    
  </nav>
</header>
<div class="content page">
  <h3 class="page-title"></h3>
  


  
  <div class="content post">
    
    <h1 class="post-title"><a href="https://lists.swift.org/pipermail/swift-evolution/Week-of-Mon-20160808/026153.html">üîó Swift ABI In Layman's terms</a></h1>
    
    <div class="post-date">
      
      <a href="/linked/2017/01/swift-abi-in-laymans-terms/">
      
      <time>16 Jan 2017</time>
      
      </a>
      
       |
      <div class="post-tags">
      
        <a href="/tag/swift">Swift</a>
      
      </div>
      
    </div>
    <p>An oldie but goodie from Swift Evelution.
<a href="https://twitter.com/slava_pestov">Slava</a>‚Äôs answer:</p>

<blockquote>
  <p>‚Äúwhen we talk about the ABI, we‚Äôre really talking about three orthogonal
‚Äúaxes‚Äù along which we would like to ‚Äúmove‚Äù without breaking compatibility with
existing binaries:‚Äù</p>

  <ul>
    <li>
      <p>The first axis is the machine-level calling conventions and memory layout.
For example, what registers to pass function arguments and returns in, the
rules for alignment and padding of fields in an aggregate type, which entry
points the Swift runtime exports and what their behavior should be. Once we
commit to a stable ABI along this axis, you will get interoperability between
<em>compiler versions</em> ‚Äì the same exact library built with one version of the
compiler will remain compatible with clients after being recompiled with
another version, because their conventions will match up. Note that this does
not help you if the library itself changes in any way.</p>
    </li>
    <li>
      <p>The second axis is the resilience work I called out in my previous e-mail.
Here, we‚Äôre trying to define language features and implementation techniques
that allow a library to evolve in a forward-compatible manner, as long as the
developer follows certain guidelines. Here, the goal is if you should be able
to compile your library, make some changes to add new APIs, and recompile it
<em>with the same compiler</em>, without breaking downstream clients, as long as you
follow the library evolution guidelines (Also, you can imagine one day having
an ‚ÄòABI diff‚Äô tool to automate this).  &gt;</p>
    </li>
    <li>
      <p>The third axis is the standard library itself. Stability of runtime
interfaces and the extra indirection to enable resilience is all great, but it
won‚Äôt help you as long as the standard library API is evolving in a
non-backwards compatible manner ‚Äì for example, if we remove a method on
String. So once the other two areas have been addressed, the last thing to lock
down is the standard library interface itself.</p>
    </li>
  </ul>
</blockquote>

<p>The rest of the thread is worth reading too. John McCall gave an high level
<a href="https://lists.swift.org/pipermail/swift-evolution/Week-of-Mon-20160808/026145.html">description</a>.</p>

<p>The definitive source for Slava‚Äôs third axes is the <a href="https://github.com/apple/swift/blob/master/docs/LibraryEvolution.rst">Library
Evolution</a>
doc from the Swift repository.</p>

  </div>
  <hr />
  
  <div class="content post">
    
    <h1 class="post-title"><a href="/2016/12/26/making-tui-programs-in-swift/">Making TUI Applications In Swift</a></h1>
    
    <div class="post-date">
      
      <time>26 Dec 2016</time>
      
       |
      <div class="post-tags">
      
        <a href="/tag/swift">Swift</a>,
      
        <a href="/tag/tui">TUI</a>
      
      </div>
      
    </div>
    <p>One of my fondest memory in programming is writing the game Snake on one of
these:</p>

<p><img src="http://dduan.net/assets/2016/12/e-dictionary.jpg" alt="An Electronic/Digital Dictionary" /></p>

<p>At the time, I was in a very restrictive school where a real computer wasn‚Äôt
permited in class. The actual thing (that‚Äôs an ‚Äúelectronic dictionary‚Äù by the
way) was probably older, slower and of a different brand than the one in the
photo. In fact, I didn‚Äôt know how to make a copy of the code, and the device
wasn‚Äôt even mine. So the game just stayed there when the device was returned to
the owener and its fate unknown.</p>

<p>But I love it nontheless. Design the game, write it, playing it, showing it off
- everything.</p>

<p><br /></p>

<p>Fastforward to today. I use and write software applications for a living.
Programs I use directly range from terminal commands to GUI apps and web apps in
a browser.</p>

<p>Some programs, however, don‚Äôt belong to those categories: vim, tig, irssi, etc.
They run in a terminal like CLI commands. But unlike commands like <code class="highlighter-rouge">ls</code>, they
take over the entire buffer to offer different modes of interaction. You can
use hotkeys to navigate menus, trigger functions and so on.  Sometimes you can
use mouse, too. Their layout often resemble that of a GUI application running in
it‚Äôs own ‚Äúwindow‚Äù:</p>

<p><img src="http://dduan.net/assets/2016/12/tig.png" alt="tig" /></p>

<p>Just to make things painfully clear, these apps‚Äôs interface is composed
exclusively of text. We can vaguely categorize them as ‚ÄúText-based User
Interface(TUI)‚Äù application.</p>

<p>There are many reasons to like TUI applications. Compared to a CLI program,
they can display information in 2-dimentional, more organized layout (aka more
like a GUI app). Unlike a GUI application, they almost only require a terminal
to run. If you ssh onto a Linux server on your iPad, they‚Äôd work the same as
running locally on a Mac. For people who live in terminal simulators, it‚Äôs nice
to run apps that don‚Äôt open a new Window. Oh, they often tend to look the same
no matter how your OS changes.</p>

<p>Most importantly, they remind me of the programs I built on that electronic
dictionary. I want to make them today, with my favorite programming language
Swift!</p>

<p><br /></p>

<p>The go-to library for writing TUI apps is <a href="https://www.gnu.org/software/ncurses/">ncurses</a>. Classics such as vim,
emacs and mutt were written with it to some degree. But I find it hard to dive
into: it has a large number of strange legacy function names and offers
pre-built UI elements like panels, menus, forms etc. The terminal in my mind is
a spread of characters that can be updated by me. That sounds fun. Ncurses seems
more like UIKit :P.</p>

<p>Luckily, I found the fun library: <a href="https://github.com/nsf/termbox">termbox</a> by <a href="https://github.com/nsf">nsf</a>. Termbox offers around
a dozen functions that gives us size of the terminal, a way to update text at
a row/column coordinates, and user inputs in forms of key-presses and
mouse-clicks. And that‚Äôs it!</p>

<p>After making <a href="https://github.com/dduan/Termbox">a Swift wrapper</a>, I was able to build a painter app in
<a href="https://github.com/dduan/TerminalPaint">a handleful of lines</a>:</p>

<p><img src="http://dduan.net/assets/2016/12/terminal-paint.png" alt="terminal paint" /></p>

<p>So that‚Äôs an TUI app drawing according to mouse clicks built with only a few
primitives from termbox. Awww yeah! Here‚Äôs the code with the comment stripped,
to give you a taste:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">Termbox</span>
<span class="kd">func</span> <span class="nf">printAt</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">Int32</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="kt">Int32</span><span class="p">,</span> <span class="nv">text</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span>
    <span class="nv">foreground</span><span class="p">:</span> <span class="kt">Attributes</span> <span class="o">=</span> <span class="o">.</span><span class="k">default</span><span class="p">,</span>
    <span class="nv">background</span><span class="p">:</span> <span class="kt">Attributes</span> <span class="o">=</span> <span class="o">.</span><span class="k">default</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">let</span> <span class="nv">border</span> <span class="o">=</span> <span class="kt">Termbox</span><span class="o">.</span><span class="n">width</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">xi</span><span class="p">)</span> <span class="k">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">unicodeScalars</span><span class="p">,</span> <span class="n">x</span> <span class="o">..&lt;</span> <span class="n">border</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">Termbox</span><span class="o">.</span><span class="nf">put</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">xi</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="nv">character</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span>
            <span class="nv">foreground</span><span class="p">:</span> <span class="n">foreground</span><span class="p">,</span> <span class="nv">background</span><span class="p">:</span> <span class="n">background</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">updateHelp</span><span class="p">(</span><span class="nv">drawing</span><span class="p">:</span> <span class="kt">UnicodeScalar</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">lastY</span> <span class="o">=</span> <span class="kt">Termbox</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">let</span> <span class="nv">content</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">"Drawing [</span><span class="se">\(</span><span class="n">drawing</span><span class="se">)</span><span class="s">]"</span><span class="p">,</span>
        <span class="s">"Press other character to change"</span><span class="p">,</span>
        <span class="s">"Use mouse to draw"</span><span class="p">,</span>
        <span class="s">"Press 'q' to quit"</span>
    <span class="p">]</span><span class="o">.</span><span class="nf">joined</span><span class="p">(</span><span class="nv">separator</span><span class="p">:</span> <span class="s">" | "</span><span class="p">)</span>

    <span class="k">let</span> <span class="nv">filler</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">repeating</span><span class="p">:</span> <span class="s">" "</span><span class="p">,</span>
        <span class="nv">count</span><span class="p">:</span> <span class="kt">Int</span><span class="p">(</span><span class="kt">Termbox</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">-</span> <span class="n">content</span><span class="o">.</span><span class="n">unicodeScalars</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>

    <span class="nf">printAt</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">lastY</span><span class="p">,</span> <span class="nv">text</span><span class="p">:</span> <span class="n">content</span> <span class="o">+</span> <span class="n">filler</span><span class="p">,</span>
        <span class="nv">foreground</span><span class="p">:</span> <span class="o">.</span><span class="n">white</span><span class="p">,</span> <span class="nv">background</span><span class="p">:</span> <span class="o">.</span><span class="n">blue</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">paint</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">do</span> <span class="p">{</span>
        <span class="k">try</span> <span class="kt">Termbox</span><span class="o">.</span><span class="nf">initialize</span><span class="p">()</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="k">let</span> <span class="nv">error</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="kt">Termbox</span><span class="o">.</span><span class="n">inputModes</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="n">esc</span><span class="p">,</span> <span class="o">.</span><span class="n">mouse</span><span class="p">]</span>

    <span class="k">var</span> <span class="nv">drawingCharacter</span><span class="p">:</span> <span class="kt">UnicodeScalar</span> <span class="o">=</span> <span class="s">"."</span> <span class="p">{</span>
        <span class="k">didSet</span> <span class="p">{</span>
            <span class="nf">updateHelp</span><span class="p">(</span><span class="nv">drawing</span><span class="p">:</span> <span class="n">drawingCharacter</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nf">updateHelp</span><span class="p">(</span><span class="nv">drawing</span><span class="p">:</span> <span class="n">drawingCharacter</span><span class="p">)</span>

    <span class="kt">Termbox</span><span class="o">.</span><span class="nf">present</span><span class="p">()</span>

    <span class="nv">outer</span><span class="p">:</span> <span class="k">while</span> <span class="kc">true</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">event</span> <span class="o">=</span> <span class="kt">Termbox</span><span class="o">.</span><span class="nf">pollEvent</span><span class="p">()</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">continue</span>
        <span class="p">}</span>

        <span class="k">switch</span> <span class="n">event</span> <span class="p">{</span>
        <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">character</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s">"q"</span> <span class="p">{</span>
                <span class="k">break</span> <span class="n">outer</span>
            <span class="p">}</span>

            <span class="n">drawingCharacter</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">key</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="o">.</span><span class="n">space</span> <span class="p">{</span>
                <span class="n">drawingCharacter</span> <span class="o">=</span> <span class="s">" "</span>
            <span class="p">}</span>

        <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">mouse</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="kt">Termbox</span><span class="o">.</span><span class="nf">put</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span>
                <span class="nv">character</span><span class="p">:</span> <span class="n">drawingCharacter</span><span class="p">,</span>
                <span class="nv">foreground</span><span class="p">:</span> <span class="o">.</span><span class="n">red</span><span class="p">)</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="p">}</span>

        <span class="kt">Termbox</span><span class="o">.</span><span class="nf">present</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kt">Termbox</span><span class="o">.</span><span class="nf">shutdown</span><span class="p">()</span>
<span class="p">}</span>

<span class="nf">paint</span><span class="p">()</span>
</code></pre>
</div>

<p><a href="https://github.com/dduan/Termbox">Library</a> and this <a href="https://github.com/dduan/TerminalPaint">app</a> are both on Github. Go and
have fun :)</p>


  </div>
  <hr />
  
  <div class="content post">
    
    <h1 class="post-title"><a href="/2016/12/24/rebase-multiple-git-commits-with-signing/">Rebase And Sign Multiple Git Commits</a></h1>
    
    <div class="post-date">
      
      <time>24 Dec 2016</time>
      
       |
      <div class="post-tags">
      
        <a href="/tag/git">Git</a>
      
      </div>
      
    </div>
    <p>I never bothered <a href="https://git-scm.com/book/en/v2/Git-Tools-Signing-Your-Work">signing</a> my git commits until Github started putting
those shiny badges on them. Since then I‚Äôve encountered a problem: rebased
commits lose their hash and their signed-ness.</p>

<p>That‚Äôs not a big deal for a single commit. Just run <code class="highlighter-rouge">git commit -S --amend
--no-edit</code> after rebase. And that commit, which is at <code class="highlighter-rouge">HEAD</code> will have a new
hash and be signed.</p>

<p>What if we have more than one commit to rebase? My instinctive answer was sign
the one on <code class="highlighter-rouge">HEAD</code>, then use interactive rebase to rotate the next one on top and
sign it, repeat until each one is signed and reorder them. But that doesn‚Äôt work
at all because a commit‚Äôs position in history is part of its content. That means
after a commit is rebased, it and every commits following it will have a new
hash and git doesn‚Äôt give us an oppurtunity to say ‚Äúinclude my signature,
please‚Äù. You cannot rebase and keep the commits signed!</p>

<p>Well, that kind of sucks. But you are reading about it here, so I‚Äôd better give
you something to help, right?</p>

<p>There is, at least, one way to achieve <em>rebase and sign multiple commits</em>:</p>

<ol>
  <li>Run interactive rebase: <code class="highlighter-rouge">git rebase -i branch</code>.</li>
  <li>Mark all commits and ‚Äúedit‚Äù or ‚Äúe‚Äù.</li>
  <li>Git now stops at every commit for you to make changes. This is an oppurtunity
to sign it! <code class="highlighter-rouge">git commit -S --amend --no-edit</code>, just like how you would sign
<code class="highlighter-rouge">HEAD</code>.</li>
  <li><code class="highlighter-rouge">git rebase --continue</code>, move on the next commit until all every one is
edited.</li>
</ol>

<p>There‚Äôs virtually nothing you cannot do with git. Hence the reputation for it‚Äôs
glorious UI, ya know?</p>


  </div>
  <hr />
  


<footer class="masthead">
<h4>Read More:</h4>
<nav class="masthead-nav">
  
  <a href="/articles">articles</a>
  
  <a href="/links">Links</a>
  
  <a href="/projects">Projects</a>
  
  <a href="/about">About</a>
  
</nav>
</footer>

</div>

  </div>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)
    },i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-59501714-1', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
