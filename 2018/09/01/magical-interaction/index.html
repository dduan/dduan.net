<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Magical Interactions</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,600">
  <link rel="stylesheet" href="/style.css">
  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Daniel Duan" href="/feed.xml" />
  <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Magical Interactions | Daniel Duan</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Magical Interactions" />
<meta name="author" content="Daniel Duan" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I want to talk about this little function:" />
<meta property="og:description" content="I want to talk about this little function:" />
<link rel="canonical" href="https://duan.ca/2018/09/01/magical-interaction/" />
<meta property="og:url" content="https://duan.ca/2018/09/01/magical-interaction/" />
<meta property="og:site_name" content="Daniel Duan" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-09-01T11:08:57-07:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@daniel_duan" />
<meta name="twitter:creator" content="@Daniel Duan" />
<script type="application/ld+json">
{"datePublished":"2018-09-01T11:08:57-07:00","headline":"Magical Interactions","mainEntityOfPage":{"@type":"WebPage","@id":"https://duan.ca/2018/09/01/magical-interaction/"},"url":"https://duan.ca/2018/09/01/magical-interaction/","author":{"@type":"Person","name":"Daniel Duan"},"description":"I want to talk about this little function:","@type":"BlogPosting","dateModified":"2018-09-01T11:08:57-07:00","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body>
  <div class="container">
    <header class="masthead">
  <h1 class="masthead-title--small">
    <a href="/">Daniel Duan</a>
  </h1>
</header>
<div class="content post">
  <h1 class="post-title">Magical Interactions</h1>
  <div class="post-date">
    <time>01 Sep 2018</time>
     | 

<div class="post-tags">

  <a href="/tag/swift">Swift</a>,

  <a href="/tag/haskell">Haskell</a>

</div>


  </div>
  <p>I want to talk about this little function:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">interact</span><span class="p">(</span><span class="n">_</span> <span class="nv">process</span><span class="p">:</span> <span class="p">(</span><span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">input</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">while</span> <span class="k">let</span> <span class="nv">line</span> <span class="o">=</span> <span class="nf">readLine</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">input</span> <span class="o">+=</span> <span class="n">line</span>
    <span class="p">}</span>

    <span class="nf">print</span><span class="p">(</span><span class="nf">process</span><span class="p">(</span><span class="n">input</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Brief explanation: it reads all the input from stdin as a <code class="highlighter-rouge">String</code>, feeds it
into a closure <code class="highlighter-rouge">process</code>, which it takes in as its only argument, and prints
<code class="highlighter-rouge">process</code>’s output.</p>

<p>Here’s how one might use it:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// counts characters from stdin and prints result to stdout</span>
<span class="n">interact</span> <span class="p">{</span> <span class="kt">String</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div></div>

<p>Got that? Well, now I’m going to rewrite it in a slightly less Swift-y way:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">count</span><span class="p">:</span> <span class="p">(</span><span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kt">String</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">interact</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</code></pre></div></div>

<p>The argument for <code class="highlighter-rouge">interact</code> got defined with a name and an explicit type
signature.</p>

<p>So, what’s so special about this <code class="highlighter-rouge">interact</code> function? Two words: <em>side effects</em>.
More precisely, it took away the concern of side-effects from the user. <code class="highlighter-rouge">count</code>
belongs in the realm of <em>pure</em> functions. It has no worries about file handles
or operating systems. It’s <code class="highlighter-rouge">(String) -&gt; String</code>. I wanted to emphasize this with
the rewrite. Look at that empty line. Now you see a boundary between 2 worlds.</p>

<p>This may all seem contrived. But when I learned about <a href="http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:interact">this function in
Haskell</a>, I was blown away.</p>

<p>It’s like a great magic trick: you are presented a scenario, say, writing
a little script. Maybe you need to process some CLI output and print out a CSV
or JSON string (literally 90% of the script I write).  A Haskell programmer
would jump into the bottom level of the problem and start writing these little
pure functions: one to split the string, one to convert some numbers, one to
manipulate a list, one to match some patterns…gradually the broken-down
absractions get built back up via function composition. You can see the light at
the end of the tunnel, yes, yes! If you feed this list into that function that
returns a string you’ll have the right value to print out!  Okay, now the
problem is solved in the pure functional world! The only thing left to do is…</p>

<p>Now, the setup of the magic is complete. Now<a class="backlink" rel="canonical" title="From duan.ca" href=https://duan.ca/2018/09/01/magical-interaction/>,</a> you are onboard with the solution,
you thought the problem through with the magician…you are distracted. The
ending came so…quickly, but unexpected. What? You just feed your solution to
this <code class="highlighter-rouge">interact</code> function and…that’s it? I was expecting some <code class="highlighter-rouge">readLine</code>s or
<code class="highlighter-rouge">print</code>s (okay, at least 1 <code class="highlighter-rouge">print</code> statement)!</p>

<p>That’s the thing: <code class="highlighter-rouge">interact</code> deals with <em>two</em> side effects, the input and the
output. But its user deals with <em>zero</em>. It’s as if the two effects “cancel” each
other out! It’s a <em>neat</em> trick, really. Small, low-key, easy to miss. But I’m
glad I noticed it and come to appreciate its power and simplicity.</p>


</div>

  </div>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)
    },i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-59501714-1', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
